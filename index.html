<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
  </head>
  <body>


    <div id="user-sidebar">
      <h4>Users you're following</h4>
      <ul id="user-list"></ul>
    </div>

    <div id="live-stream">
      <h2>Home Timeline</h2>
      <ul id="live-tweet-list"></ul>
    </div>

    <div id="user-timeline">

      <h3>No User Selected</h3>
      <ul id="user-tweets"></ul>

    </div> 


    <script>
      $(document).ready(function(){
        var $stream = $('#live-tweet-list');
        //$body.html('');
        var lastTweetIndex = -1;

        streams.home.forEach(function(tweet, index) {
          var $tweetItem = $('<li class="live-tweet"></li>')
          var $tweet = $('<div class="tweet"></div>');
          var $timeStamp = $('<div class="timeStamp"></div>');
          $tweet.text('@' + tweet.user + ': ' + tweet.message);
          $timeStamp.text('Tweeted on ' + tweet.created_at);
          $timeStamp.prependTo($tweetItem);
          $tweet.prependTo($tweetItem);
          $tweetItem.appendTo($stream);
          lastTweetIndex= index;
          
        });

        users.forEach( function(name, index) {
          //alert(name)
          var $nameDisplay = $('<li></li>');
          var $nameLink = $('<a href="#" class="user-link">@'+name+'</a>');
          $nameDisplay.append($nameLink)
          $('#user-list').append($nameDisplay);
        });

        $('a.user-link').on('click',function(event){
          event.preventDefault();
          var user = $(this).text();
          var user = user.slice(1) //Get rid of @ symbol
          $('#user-timeline').find('h3').text("@" + user + "'s Timeline")
          var tweets = streams.users[user];
          var UserTweets = $('#user-tweets');
          UserTweets.find('li').remove();
          tweets.forEach(function(tweet) {
            var $tweetItem = $('<li class="user-tweet"></li>')
            var $tweet = $('<div class="tweet"></div>');
            var $timeStamp = $('<div class="timeStamp"></div>');
            $tweet.text('@' + tweet.user + ': ' + tweet.message);
            $timeStamp.text('Tweeted on ' + tweet.created_at);
            $timeStamp.prependTo($tweetItem);
            $tweet.prependTo($tweetItem);
            $tweetItem.appendTo(UserTweets);
          });
        });

        setInterval(function() {
          while (lastTweetIndex != streams.home.length - 1) {
            lastTweetIndex++;
            var tweet = streams.home[lastTweetIndex];
            var $tweetItem = $('<li class="live-tweet"></li>')
            var $tweet = $('<div class="tweet"></div>');
            var $timeStamp = $('<div class="timeStamp"></div>');
            $tweet.text('@' + tweet.user + ': ' + tweet.message);
            $timeStamp.text('Tweeted on ' + tweet.created_at);
            $timeStamp.prependTo($tweetItem);
            $tweet.prependTo($tweetItem);
            $tweetItem.prependTo($stream);

          }
        }, 1500)

    

      });
    </script>

  </body>
</html>
