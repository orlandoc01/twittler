<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
  </head>
  <body>


    <div id="user-sidebar" style="float:left;width:30%">
      <h4>Users you're following</h4>
      <ul id="user-list"></ul>
    </div>

    <div id="live-stream" style = "float:right;width:70%">
      <h2>Home Timeline</h2>
      <button id="update-button">Update TimeLine</button>
      <ul id="live-tweet-list"></ul>
    </div>

    <div id="user-timeline" style="float:left;width:30%">

      <h3>No User Selected</h3>
      <ul id="user-tweets"></ul>

    </div> 


    <script>
      $(document).ready(function(){
        var $stream = $('#live-tweet-list');
        //$body.html('');
        var lastTweetIndex = -1;

        function createTweetListItem(tweet) {
          var $tweetListItem = $('<li class="live-tweet"></li>')
          var $tweet = $('<div class="tweet"></div>');
          var $timeStamp = $('<div class="timeStamp"></div>');
          var $handle = $('<a href="#" class="user-link">@'+tweet.user+'</a>');
          $handle.on('click', showUserTimeline)
          $tweet.text(":" + tweet.message);
          $tweet.prepend($handle);
          $timeStamp.text('Tweeted on ' + tweet.created_at);
          $timeStamp.prependTo($tweetListItem);
          $tweet.prependTo($tweetListItem);
          return $tweetListItem;
        }

        function showUserTimeline(event) {
           event.preventDefault();
          var user = $(this).text();
          var user = user.slice(1) //Get rid of @ symbol
          $('#user-timeline').find('h3').text("@" + user + "'s Timeline")
          var tweets = streams.users[user];
          var UserTweets = $('#user-tweets');
          UserTweets.find('li').remove();
          tweets.forEach(function(tweet) {
            var $tweetItem = createTweetListItem(tweet);
            $tweetItem.prependTo(UserTweets);
          });
        }

        streams.home.forEach(function(tweet, index) {
          var $tweetListItem = createTweetListItem(tweet);
          $tweetListItem.appendTo($stream);
          lastTweetIndex= index;
          
        });

        users.forEach( function(name, index) {
          //alert(name)
          var $nameDisplay = $('<li></li>');
          var $nameLink = $('<a href="#" class="user-link">@'+name+'</a>');
          $nameLink.on('click', showUserTimeline);
          $nameDisplay.append($nameLink)
          $('#user-list').append($nameDisplay);
        });

        $("#update-button").on('click',function() {
          while (lastTweetIndex != streams.home.length - 1) {
            lastTweetIndex++;
            var tweet = streams.home[lastTweetIndex];
            var $tweetListItem = createTweetListItem(tweet);
            $tweetListItem.prependTo($stream);

          }
        });

    

      });
    </script>

  </body>
</html>
