<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <link rel="stylesheet" type="text/css" href="main.css">

  </head>
  <body>

    <div id="container">
      <div id="user-sidebar">
        <h4>Users you're following</h4>
        <ul id="user-list"></ul>
      </div>

      <div id="live-stream">
        <h2>Home Timeline</h2>
        <button id="update-button">Update TimeLine</button>
        <ul id="live-tweet-list"></ul>
      </div>

      <div id="user-timeline">
        <h3>No User Selected</h3>
        <ul id="user-tweets"></ul>
      </div> 
    </div>


    <script>
      $(document).ready(function(){

        //$stream will reference the live tweet list
        var $stream = $('#live-tweet-list');
        var lastTweetIndex = -1;

        //Function below will create a new TweetList item to add to $stream whenever
        //it is given a tweet object
        function createTweetListItem(tweet) {
          var $tweetListItem = $('<li class="tweet"></li>')
          var $tweet = $('<div class="tweet-message"></div>');
          var $timeStamp = $('<div class="timeStamp"></div>');
          var $handle = $('<a href="#" class="user-link">@'+tweet.user+'</a>');
          $handle.on('click', showUserTimeline)
          $tweet.text(":" + tweet.message);
          $tweet.prepend($handle);
          $timeStamp.text('Tweeted on ' + tweet.created_at);
          $timeStamp.prependTo($tweetListItem);
          $tweet.prependTo($tweetListItem);

          $tweetListItem.on( "mouseenter", function() {
            $(this).addClass("highlighted")
          });

          $tweetListItem.on("mouseleave", function() {
            $(this).removeClass("highlighted");
          })

          return $tweetListItem;
        }

        //Function below will trigger whenever a userhandle is clicked. It essentially
        //shows all of a user's tweets in the user-timeline div. It is given an event
        //object when triggered with the on() function to prevent typicaly anchor behavior
        //when an anchor is clicked using the preventDefault method
        function showUserTimeline(event) {
           event.preventDefault();
          var user = $(this).text();
          var user = user.slice(1) //Get rid of @ symbol
          $('#user-timeline').find('h3').text("@" + user + "'s Timeline")
          var tweets = streams.users[user];
          var UserTweets = $('#user-tweets');
          UserTweets.find('li').remove();
          tweets.forEach(function(tweet) {
            var $tweetItem = createTweetListItem(tweet);
            $tweetItem.prependTo(UserTweets);
          });
        }

        //For each tweet within the streams.home array, we create a tweet li item and display
        //it in the $stream. We also keep track of whatever the lastTweet index was when finished.
        streams.home.forEach(function(tweet, index) {
          var $tweetListItem = createTweetListItem(tweet);
          $tweetListItem.appendTo($stream);
          lastTweetIndex= index;
          
        });

        //For each user we follow, we want to create a li item and display it in the user-sidebar
        //div. We also attach the showUserTimeline function to each user handle link, which will
        //trigger whenever the handle is clicked
        users.forEach( function(name, index) {
          //alert(name)
          var $nameDisplay = $('<li></li>');
          var $nameLink = $('<a href="#" class="user-link">@'+name+'</a>');
          $nameLink.on('click', showUserTimeline);
          $nameDisplay.append($nameLink)
          $('#user-list').append($nameDisplay);
        });

        //we attach to the update button a function that continuously updates the $stream list
        //until we've read all of the tweets at the present moment whenever it is clicked
        $("#update-button").on('click',function() {
          while (lastTweetIndex != streams.home.length - 1) {
            lastTweetIndex++;
            var tweet = streams.home[lastTweetIndex];
            var $tweetListItem = createTweetListItem(tweet);
            $tweetListItem.prependTo($stream);

          }
        });

    

      });
    </script>

  </body>
</html>
